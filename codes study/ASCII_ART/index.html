<!-- 출처: https://www.youtube.com/watch?v=8tGIj076_8Q -->
<!-- 참고: https://en.wikipedia.org/wiki/Whitespace_character -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

</head>
<body style="margin:0; font-family: 'consolas'; line-height: 85%; letter-spacing:2px; font-size:10px;">

    <canvas id="canvas" width="300" height="300" style="border: 1px solid gray;"></canvas>
    <h4 id="ascii-output"> </h4>
    <script>
        img_name = 'name.png'

        let img =new Image()
        img.crossOrigin = "anonymous";  // 만약 CORS 문제 생길 시
        img.src = img_name
        
        let canvas = document.querySelector('#canvas')
        let ctx = canvas.getContext('2d')

        let ascii = '@$#Y!=+~- ' // 밝기 낮을수록 왼쪽

        img.addEventListener('load', function(){
            ctx.drawImage(img, 0, 0, 300, 300);
            
            // 이미지 데이터 한 번에 불러오기
            const imageData = ctx.getImageData(0, 0, 300, 300).data;
            let asciiImage = '';

            // 5픽셀 간격으로 루프
            for (let j = 0; j < 300; j += 5) {
                for (let i = 0; i < 300; i += 5) {
                    const index = (j * 300 + i) * 4;  // RGBA는 4바이트씩
                    const r = imageData[index];
                    const g = imageData[index + 1];
                    const b = imageData[index + 2];

                    // 회색조 변환
                    const gray = 0.299 * r + 0.587 * g + 0.114 * b;

                    // 문자의 밝기 단계 계산
                    const asciiIndex = Math.floor(gray / 25.6);
                    asciiImage += ascii[asciiIndex] || ' ';
                }
                asciiImage += '<br>';
            }

            // 한 번에 DOM에 반영
            document.querySelector('#ascii-output').innerHTML = asciiImage;

            /*for (let j = 0; j < 300; j += 5){
                for (let i = 0; i < 300; i += 5){
                    let pixel = ctx.getImageData(i, j, 1, 1).data
                    let gray = 0.299*pixel[0] + 0.587*pixel[1] + 0.114*pixel[2]
                    let index = Math.floor(gray/25.6)
                    document.querySelector('h4').innerText += ascii[index]
                    if (i >= 295) {
                        document.querySelector('h4').innerHTML += '<br>'
                    }
                }
            }*/
        });

    </script>

</body>
</html>
