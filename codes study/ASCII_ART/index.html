<!-- ì¶œì²˜: https://www.youtube.com/watch?v=8tGIj076_8Q -->
<!-- ì°¸ê³ : https://en.wikipedia.org/wiki/Whitespace_character -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Art Generator</title>

    <style>
    body {
      margin: 0;
      font-family: 'Consolas', monospace;
      line-height: 85%;
      letter-spacing: 2px;
      font-size: 10px;
    }
    #canvas, #ascii-canvas {
      display: block;
      margin-bottom: 10px;
      border: 1px solid gray;
    }
    #ascii-output {
      white-space: pre;
      font-size: 10px;
      line-height: 1;
      margin-top: 10px;
    }
    #drop-area {
      border: 2px dashed #ccc;
      padding: 20px;
      margin: 15px 0;
      min-height: 200px;
      background-color: #f9f9f9;
      display: flex;
      justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ */
      align-items: center;     /* ì„¸ë¡œ ì¤‘ì•™ */
      text-align: center;      /* í…ìŠ¤íŠ¸ê°€ ì—¬ëŸ¬ ì¤„ì¼ ë•Œ ê°€ìš´ë° ì •ë ¬ */
    }
    </style>
</head>
<body>
    <h2>ğŸ¨ ASCII Art Generator</h2>

    <div style="margin:10px;">
        <label>ì´ë¯¸ì§€ í¬ê¸° ë¹„ìœ¨: <input id="scaleInput" type="number" min="0.1" max="1" step="0.1" value="1" style="width:50px;"> (0.1~1)</label>
        <label title="í”½ì…€ ê°„ê²©ì´ ë„ˆë¬´ ì‘ìœ¼ë©´ ì´ë¯¸ì§€ê°€ ë„ˆë¬´ ê¸¸ì–´ì§. ì ë‹¹íˆ ì¡°ì ˆí•˜ì„¸ìš”."style="margin-left:15px;">ë³€í™˜ í”½ì…€ ê°„ê²©(px): <input id="gapInput" type="number" min="1" max="20" step="1" value="5" style="width:50px;"></label>
        <label style="margin-left:15px;">í°íŠ¸ í¬ê¸°(px): <input id="fontSizeInput" type="number" min="2" max="20" step="1" value="6" style="width:50px;"></label>
        <br><br>
        <label>ASCII ë¬¸ìì…‹: <input id="asciiInput" type="text" value="@$#Y!=+~-â€€" style="width:200px;"></label>
        <button id="generateBtn" style="margin-left:15px;">ë‹¤ì‹œ ìƒì„±</button>
    </div>

    <div id="drop-area">
        ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì—¬ê¸°ì— ë†“ê±°ë‚˜, ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì—…ë¡œë“œí•˜ì„¸ìš”.
    </div>
    <input type="file" id="fileInput" accept="image/*">

    <canvas id="canvas"></canvas>
    <canvas id="ascii-canvas" style="display:none;"></canvas>
    <h4 id="ascii-output"> </h4>
    <div style="margin:10px 0;">
        <button id="downloadTxtBtn">TXT í…ìŠ¤íŠ¸ ì €ì¥</button>
        <button id="downloadPngBtn">PNG ì´ë¯¸ì§€ ì €ì¥</button>
        <label>
            <input type="checkbox" id="transparentBgCheckbox" title="ì²´í¬ í•´ì œ ì‹œ ë°°ê²½ì´ í°ìƒ‰ìœ¼ë¡œ ì±„ì›Œì§" checked>
                ë°°ê²½ íˆ¬ëª…
        </label>
    </div>

    <script>
        let img =new Image()
        img.crossOrigin = "anonymous";  // ë§Œì•½ CORS ë¬¸ì œ ìƒê¸¸ ì‹œ
        img.src = 'free-icon-transform-text.png' // ê¸°ë³¸ ì´ë¯¸ì§€

        const canvas = document.querySelector('canvas')
        const ctx = canvas.getContext('2d')
        const asciiCanvas = document.getElementById('ascii-canvas');
        const asciiCtx = asciiCanvas.getContext('2d');

        const output = document.getElementById('ascii-output');
        
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('fileInput');
        
        //const downloadTxtBtn = document.querySelector('downloadTxtBtn');
        //const downloadPngBtn = document.querySelector('downloadPngBtn');

        const scaleInput = document.getElementById('scaleInput');
        const gapInput = document.getElementById('gapInput');
        const fontSizeInput = document.getElementById('fontSizeInput');
        const asciiInput = document.getElementById('asciiInput');
        const generateBtn = document.getElementById('generateBtn');

        let asciiImage = '';

        function generateASCIIFromImage(sourceImage) {
            const scale = parseFloat(scaleInput.value);
            const gap = parseInt(gapInput.value);
            const fontSize = parseInt(fontSizeInput.value);
            const asciiChars = asciiInput.value;

            if (!asciiChars || asciiChars.length < 2) {
            alert('ASCII ë¬¸ìì…‹ì€ ìµœì†Œ 2ê°œ ì´ìƒ ì…ë ¥í•˜ì„¸ìš”.');
            return;
            }
            const width = Math.floor(sourceImage.width * scale);
            const height = Math.floor(sourceImage.height * scale);

            // í¬ê¸°ì— ë§ì¶° ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
            canvas.width = asciiCanvas.width = width;
            canvas.height = asciiCanvas.height = height;

            // ì›ë³¸ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
            ctx.clearRect(0, 0, width, height);
            ctx.drawImage(sourceImage, 0, 0, width, height);

            // ASCII ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
            asciiCtx.clearRect(0, 0, width, height);
            asciiCtx.fillStyle = 'black';
            asciiCtx.font = `${fontSize}px Consolas`;
            asciiCtx.textBaseline = 'top';

            // ìº”ë²„ìŠ¤ í¬ê¸°ì— ë§ëŠ” í”½ì…€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const imageData = ctx.getImageData(0, 0, width, height).data;
            
            // ì´ˆê¸°í™”
            asciiImage = '';

            for (let y = 0; y < height; y += gap) {
            let line = '';
            for (let x = 0; x < width; x += gap) {
                const index = (y * width + x) * 4;
                const r = imageData[index];
                const g = imageData[index + 1];
                const b = imageData[index + 2];
                const gray = 0.299 * r + 0.587 * g + 0.114 * b;

                const charIndex = Math.floor(gray / (256 / asciiChars.length));
                const char = asciiChars[charIndex] || ' ';
                line += char;

                asciiCtx.fillText(char, x, y);
            }
            asciiImage += line + '\n';
            }
            // í•œ ë²ˆì— DOMì— ë°˜ì˜
            output.innerText = asciiImage;
        }

        // ì´ˆê¸° ì´ë¯¸ì§€ ë¡œë“œ ì‹œ
        img.addEventListener('load', () => generateASCIIFromImage(img));
        generateBtn.addEventListener('click', () => generateASCIIFromImage(img));
        
        // ì›ë³¸ ì½”ë“œ
        /*img.addEventListener('load', function(){
            ctx.drawImage(img, 0, 0)
            for (let j = 0; j < 300; j += 5){
                for (let i = 0; i < 300; i += 5){
                    let pixel = ctx.getImageData(i, j, 1, 1).data
                    let gray = 0.299*pixel[0] + 0.587*pixel[1] + 0.114*pixel[2]
                    let index = Math.floor(gray/25.6)
                    document.querySelector('h4').innerText += ascii[index]
                    if (i >= 295) {
                        document.querySelector('h4').innerHTML += '<br>'
                    }
                }
            }
        })*/

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥ ì¶”ê°€
        dropArea.addEventListener('dragover', e => {
            e.preventDefault();
            dropArea.style.background = '#f8f8f8';
        });

        dropArea.addEventListener('dragleave', () => {
            dropArea.style.background = '';
        });

        dropArea.addEventListener('drop', e => {
            e.preventDefault();
            dropArea.style.background = '';
            const file = e.dataTransfer.files[0];
            handleFile(file);
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            handleFile(file);
        });

        function handleFile(file) {
            if (!file || !file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
        }

        const reader = new FileReader();
            reader.onload = e => {
                const newImg = new Image();
                newImg.onload = () => {
                img = newImg;
                generateASCIIFromImage(img);
                };
                newImg.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­ ì‹œ íŒŒì¼ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
        // TXT ì €ì¥ ë²„íŠ¼
        document.getElementById('downloadTxtBtn').addEventListener('click', () => {
            let fileName = prompt("ì €ì¥í•  íŒŒì¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (í™•ì¥ì ì—†ì´):", "ascii-art");
            if (!fileName) return;
            if (!fileName.toLowerCase().endsWith('.txt')) fileName += '.txt';

            const blob = new Blob([asciiImage], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            URL.revokeObjectURL(url);
        });
        // PNG ì €ì¥ ë²„íŠ¼
        document.getElementById('downloadPngBtn').addEventListener('click', () => {
            let fileName = prompt("ì €ì¥í•  íŒŒì¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (í™•ì¥ì ì—†ì´):", "ascii-art");
            if (!fileName) return;
            if (!fileName.toLowerCase().endsWith('.png')) fileName += '.png';

            const isTransparent = document.getElementById('transparentBgCheckbox').checked;

            // ì„ì‹œ ìº”ë²„ìŠ¤ ìƒì„±
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = asciiCanvas.width;
            tempCanvas.height = asciiCanvas.height;

            if (!isTransparent) {
                // ë°°ê²½ í°ìƒ‰ ì±„ìš°ê¸°
                tempCtx.fillStyle = 'white';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
            } else {
                // íˆ¬ëª… ë°°ê²½ (ê¸°ë³¸ í´ë¦¬ì–´)
                tempCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
            }

            // asciiCanvas ê·¸ë¦¼ ë³µì‚¬
            tempCtx.drawImage(asciiCanvas, 0, 0);

            // Blobìœ¼ë¡œ ë³€í™˜ í›„ ë‹¤ìš´ë¡œë“œ
            tempCanvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                // ê²°ê³¼ë¬¼ ìƒˆì°½ì—´ê¸°
                window.open(url, '_blank');

                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                URL.revokeObjectURL(url);
            }, 'image/png');
        });
    </script>

</body>
</html>

